<section>
  <div class=" container-fluid my-2 ">
    <div class="row justify-content-center ">
      <div class="col-xl-10">
        <div class="card shadow-lg ">
          <div class="row  mx-auto justify-content-center text-center mt-3">
            <h3>CHECKOUT</h3>
          </div>
          <form id="checkout-form" method="post" enctype="multipart/form-data">
            <div class="row justify-content-around">
              <div class="col-md-5">
                <div class="card border-0">
                  <div class="card-header ">
                    <h5 class="card-text text-muted mt-2 space">SHIPPING DETAILS</h5>
                  </div>
                  <div class="card-body text-muted ">
                    <div class="form-row">
                      <div class="form-floating mb-3">
                        <input type="text" name="name" style="" class="form-control" placeholder="name" required>
                        <label for="Textarea">Name</label>
                        <input type="text" name="userId" id="" value="{{user._id}}" hidden>
                      </div>
                      <div class="form-floating mb-3">
                        <textarea class="form-control" name="address" placeholder="Leave a comment here"
                          id="floatingTextarea2" style="height: 100px" required></textarea>
                        <label for="floatingTextarea2">Address</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input type="text" name="mobile"  class="form-control" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" placeholder="contact" required>
                        <label for="floatingInput">Contact No</label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="form-floating mb-3">
                          <input type="text" name="city" class="form-control" placeholder="city" required>
                          <label for="floatingInput">City</label>
                        </div>
                      </div>
                      <div class="col">
                        <div class="form-floating">
                          <select class="form-select" name="state" id="floatingSelectGrid"
                            aria-label="Floating label select example">
                            <option selected>--Select--</option>
                            <option value="kerala">Kerala</option>
                            <option value="Tamilnadu">Tamilnadu</option>
                            <option value="Karnataka">Karnataka</option>
                          </select>
                          <label for="floatingSelectGrid">State</label>
                        </div>
                      </div>
                      <div class="col">
                        <div class="form-floating mb-4">
                          <input type="text" name="pincode" maxlength="6" minlength="6" class="form-control" placeholder="name@example.com" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                            required>
                          <label for="floatingInput">Pincode</label>
                        </div>
                      </div>
                    </div>
                    <div class="card-header mb-3">
                      <h6 class="card-text text-muted mt-2 space">PAYMENT METHOD</h6>
                    </div>
                    <div class="form-check mb-2">
                      <input class="form-check-input" type="radio" name="payment-method" id="exampleRadios1" value="COD"
                        checked>
                      <label class="form-check-label" for="exampleRadios1">
                        Cash On Delivery
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="payment-method" id="exampleRadios2"
                        value="CARD">
                      <label class="form-check-label" for="exampleRadios2">
                        Card Payment
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-5">
                <div class="card border-0 ">
                  <div class="card-header card-2">
                    <h5 class="card-text text-muted mt-2 md-4 space">YOUR ORDER</h5>
                  </div>
                  <div class="card-body pt-0">
                    {{#each products}}
                    <div class="row  justify-content-between mt-3">
                      <div class="col-auto col-md-7 mb-1">
                        <div class="media flex-column flex-sm-row">
                          <img class=" img-fluid" src="/product-image/{{this.product._id}}.jpg" width="62" height="62">
                          <div class="media-body  my-auto ">
                            <div class="row">
                              <div class="col-auto">
                                <p class="mb-0"><b>{{this.product.name}}</b></p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class=" pl-0 flex-sm-col col-auto  my-auto">
                        <p class="boxed-1">{{this.quantity}}</p>
                      </div>
                      <div class=" pl-0 flex-sm-col col-auto  my-auto ">
                        <p><b>{{this.product.price}}</b></p>
                      </div>
                    </div>
                    {{/each}}

                    <hr class="my-2">
                    <div class="row ">
                      <div class="col">
                        <div class="row justify-content-between">
                          <div class="col-4">
                            <p class="mb-1"><b>Subtotal</b></p>
                          </div>
                          <div class="flex-sm-col col-auto">
                            <p class="mb-1"><b>&#x20b9;{{total}}</b></p>
                          </div>
                        </div>
                        <div class="row justify-content-between">
                          <div class="col">
                            <p class="mb-1"><b>Delivery Charges</b></p>
                          </div>
                          <div class="flex-sm-col col-auto">
                            <p class="mb-1"><b>FREE</b></p>
                          </div>
                        </div>
                        <div class="row justify-content-between">
                          <div class="col-4">
                            <p><b>Total</b></p>
                          </div>
                          <div class="flex-sm-col col-auto">
                            <p class="mb-1"><b>&#x20b9;{{total}}</b></p>
                          </div>
                        </div>
                        <hr class="my-0">
                      </div>
                    </div>
                    <div class="row mb-5 mt-4 ">
                      <button type="submit"  class="btn btn-outline-primary ">Checkout</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>


<script>
  $("#checkout-form").submit((e) => {
    e.preventDefault()
    $.ajax({
      url: '/placeOrder',
      method: 'post',
      data: $('#checkout-form').serialize(),
      success:(response) => {
        if(response.status){
          location.href='/order-feedback'
        }
      }

    })
  })

</script>